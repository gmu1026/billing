---

# 📝 전표 자동화 및 관리 시스템 (Slip Automation System)

## 1. 프로젝트 개요 (Project Overview)

### 1.1. 배경 및 문제 정의

* **현재 상황:** 엑셀을 이용한 수기 전표 작성으로 인해 반복 업무가 과중하고, 휴먼 에러(코드 오기입, 날짜 실수 등) 발생 위험이 높음.
* **목표:**
* 복잡한 재무 마스터 데이터(GL계정, 코스트센터 등)를 DB화하여 유효성 검증 자동화.
* 매월 반복되는 청구 전표(매출/비용)를 '스마트 프리셋'을 통해 원클릭으로 생성.
* 외부 API 연동을 통해 계약 금액을 자동으로 불러와 수기 입력 최소화.
* 최종 결과물을 기존 시스템 업로드용 엑셀/CSV 포맷으로 변환 및 다운로드.



### 1.2. 기술 스택 (Tech Stack)

* **Backend:** Python **FastAPI** (높은 생산성, Pydantic을 이용한 강력한 데이터 검증)
* **Frontend:** **React** + **TypeScript** (UI/UX 최적화 및 타입 안정성)
* **UI Library:** **Shadcn/UI** + **Tailwind CSS** (모던하고 깔끔한 디자인, 캘린더/팝오버 등 컴포넌트 활용)
* **State/Data Mgmt:** **TanStack Query** (서버 데이터 동기화), **TanStack Table** (복잡한 그리드 처리)
* **Database:** SQLite (개발용) / PostgreSQL (운영용)

---

## 2. 시스템 아키텍처 및 데이터 흐름

### 2.1. 데이터베이스 설계 (ERD Concept)

엑셀로 관리되던 마스터 데이터를 정규화하여 DB로 이관합니다.

1. **Master Tables (기초 정보):**
* `AccountCode` (계정코드): HKONT, 계정명
* `CostCenter` (부서/코스트센터): KOSTL, 부서명
* `TaxCode` (세금코드): MWSKZ, 요율
* `Customer` (거래처): PARTNER, 사업자번호, 담당자 이메일


2. **Preset Tables (스마트 템플릿):**
* `PresetGroup`: 프리셋 그룹명 (예: "G마켓 정기 청구", "매월 10일 고정비")
* `PresetItem`: 그룹에 속한 개별 전표 규칙
* `day_rule`: 자동 생성 날짜 (예: 10 -> 매월 10일)
* `text_template`: 적요 템플릿 (예: "{MM}월 G마켓 전용선 사용료")
* `fixed_amount`: 고정 금액 (변동 시 0 또는 null)
* `contract_id`: 외부 API 호출용 계약 ID





### 2.2. 핵심 프로세스 흐름

1. **원가/매출 전표 (Bulk Upload):**
* 사용자 엑셀 업로드 -> 백엔드 파싱 -> 마스터 데이터와 대조(Validation) -> **오류 리포트(UI)** -> 수정 -> 최종 생성


2. **청구 전표 (Smart Creation):**
* "2026년 2월" 선택 -> 프리셋 그룹 선택 -> **백엔드 로직(날짜 계산, 텍스트 치환, API 금액 조회)** -> UI 그리드 출력 -> 사용자 검토/수정 -> 최종 생성



---

## 3. 기능 명세 (Feature Specifications)

### 3.1. 스마트 프리셋 (Smart Preset Engine)

단순 복사가 아닌, **규칙 기반(Rule-based)** 생성 엔진입니다.

* **날짜 자동화:** 사용자가 타겟 월(Target Month)을 선택하면, 설정된 `day_rule`에 맞춰 `BLDAT`(증빙일), `BUDAT`(전기일) 자동 생성.
* **적요 동적 생성:** 템플릿 변수 (`{YYYY}`, `{MM}`, `{PREV_MM}`)를 활용하여 매월 텍스트 자동 변환.
* **일괄 불러오기:** 하나의 그룹(예: SKBB 비용) 호출 시, 연관된 N개의 전표 라인을 한 번에 생성.

### 3.2. 외부 데이터 연동 (External Data Integration)

* 금액, 계약 정보 등 변동 가능성이 있는 데이터는 별도 구축된 API를 호출하여 가져옴.
* **Proxy Endpoint:** Frontend는 백엔드의 `/api/external/contract/{id}`를 호출하고, 백엔드가 실제 외부 API와 통신 (보안 및 데이터 가공 목적).

### 3.3. 유효성 검증 및 UX (Validation & UX)

* **실시간 피드백:** 계정코드 입력 시 존재하지 않는 코드면 붉은색 테두리 표시.
* **검색 편의성:** 코드를 외울 필요 없이, '부서명'이나 '계정명' 검색 시 해당 코드(KOSTL, HKONT) 자동 입력 (Combobox 활용).
* **자동 매핑:** 부서 선택 시 연관된 `Profit Center` 등 파생 정보 자동 기입.

### 3.4. 파일 내보내기 (Export)

* 검증이 완료된 데이터를 업로드 양식(`업로드레이아웃.csv`)과 100% 동일한 헤더와 포맷으로 변환하여 다운로드 제공.

---

## 4. API 명세 (Draft)

| Method | Endpoint | Description |
| --- | --- | --- |
| `GET` | `/api/master/accounts` | 계정코드 목록 조회 (검색용) |
| `GET` | `/api/presets` | 프리셋 그룹 목록 조회 |
| `POST` | `/api/slips/generate/preset` | 타겟 월과 프리셋 ID를 받아 전표 데이터(JSON) 생성 및 반환 |
| `POST` | `/api/slips/validate` | 작성된 전표 리스트의 유효성 검증 |
| `POST` | `/api/slips/export` | 검증된 JSON 데이터를 Excel/CSV 파일로 변환하여 다운로드 |

---

## 💡 추가 구현 아이디어 및 제안 (Bonus Ideas)

프로젝트의 완성도와 사용자 경험을 극대화하기 위해 다음 기능들을 고려해보세요.

### 1. "휴일 보정" 로직 (Business Day Calculation)

* **문제:** 프리셋으로 '매월 10일'을 지정했는데, 10일이 일요일이라면?
* **아이디어:** 프리셋 설정에 `휴일 처리 규칙` 옵션을 둡니다.
* `Forward`: 다음 영업일로 자동 변경 (11일 월요일)
* `Backward`: 이전 영업일로 변경 (8일 금요일)
* `Exact`: 휴일 상관없이 날짜 유지
* 이를 위해 한국 공휴일 라이브러리(`workalendar` 등)를 백엔드에 적용하면 매우 디테일한 기능이 됩니다.



### 2. 차변/대변 자동 밸런싱 (Auto-Balancing)

* **문제:** 전표 작성 시 가장 큰 실수는 차변(Debit)과 대변(Credit) 합계가 맞지 않는 것입니다.
* **아이디어:**
* 매출 전표 작성 시, `공급가액`을 입력하면 -> `부가세(Tax)` 라인과 `외상매출금(AR)` 라인을 자동으로 계산해서 추가해주는 기능을 넣습니다.
* UI 하단에 항상 **[ 차변 합계 | 대변 합계 | 차이(Diff) ]** 상태 바를 띄워 차이가 0이 아니면 저장이 안 되게 막습니다.



### 3. "복사해서 생성" 기능 (Deep Copy)

* **문제:** 프리셋에는 없지만, 지난달에 썼던 특이한 건을 이번 달에도 한 번 더 써야 할 때.
* **아이디어:** "과거 전표 조회" 메뉴를 두고, 특정 행을 선택해 **"현재 월로 복사"** 버튼을 만듭니다. 날짜만 이번 달로 바뀌고 나머지는 그대로 복사되어 입력 폼으로 가져옵니다.

### 4. 엑셀 업로드 시 "Diff View" 제공

* **아이디어:** 사용자가 수정한 엑셀을 재업로드할 때, 기존 데이터와 무엇이 바뀌었는지(예: 금액이 100원에서 200원으로 변경됨)를 시각적으로 보여주면 검토 시간을 획기적으로 줄일 수 있습니다. (Git Diff와 유사한 개념)

### 5. 임시 저장 (Draft Mode)

* 웹서비스 특성상 작성 중에 브라우저가 꺼질 수 있습니다. `LocalStorage`를 활용해 작성 중인 내용을 실시간으로 임시 저장하고, 재접속 시 "작성 중인 내용이 있습니다. 불러오시겠습니까?"를 띄워주면 UX 만족도가 매우 높아집니다.